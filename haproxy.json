{"title":"HAProxy EKS Dashboard - Comprehensive","description":"This dashboard provides a detailed overview of HAProxy performance across AWS EKS. It tracks metrics like request rates, error rates, and response codes, enabling quick identification and troubleshooting of issues.","widgets":[{"id":309104169356102,"definition":{"type":"note","content":"CTA HA-Proxy Dashboard","background_color":"blue","font_size":"16","text_align":"center"},"layout":{"x":0,"y":0,"width":12,"height":2}},{"id":6424067052901893,"definition":{"title":"Request Rate per Second","show_legend":false,"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:haproxy.backend.request.rate{$eks_cluster, $pod_name, $aws_account}"}],"display_type":"line"}]},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":8622556581497208,"definition":{"title":"Logs","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6924475761944722,"definition":{"title":"HAProxy Logs","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"logs_stream","query_string":"source:*haproxy*","indexes":[],"storage":"hot","sort":{"order":"desc","column":"timestamp"}},"columns":[{"field":"status_line","width":"auto"},{"field":"timestamp","width":"auto"},{"field":"host","width":"auto"},{"field":"@service","width":"auto"},{"field":"content","width":"compact"}]}],"type":"list_stream"},"layout":{"x":0,"y":0,"width":4,"height":8}}]},"layout":{"x":4,"y":0,"width":4,"height":9}},{"id":6806697681034660,"definition":{"title":"Pod Statistics","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6378929529843446,"definition":{"title":"Top Resource Consumers","type":"query_table","requests":[{"response_format":"scalar","queries":[{"query":"sum:kubernetes.cpu.usage.total{kube_namespace:ingress-haproxy,short_image:haproxy} by {pod_name}","data_source":"metrics","name":"query1","aggregator":"avg"},{"query":"sum:kubernetes.memory.usage{kube_namespace:ingress-haproxy,short_image:haproxy} by {pod_name}","data_source":"metrics","name":"query2","aggregator":"avg"}],"formulas":[{"alias":"CPU Cores","limit":{"count":10,"order":"desc"},"formula":"query1"},{"alias":"Memory","formula":"query2"}]}]},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":361171846595104,"definition":{"title":"CPU Usage by Pod","show_legend":false,"legend_size":"0","type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:kubernetes.cpu.usage.total{kube_namespace:ingress-haproxy,short_image:haproxy} by {pod_name}"}],"formulas":[{"formula":"autosmooth(query1)"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"},{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:kubernetes.cpu.limits{kube_namespace:ingress-haproxy,short_image:haproxy}"}],"formulas":[{"formula":"autosmooth(query1)"}],"style":{"palette":"warm","line_type":"solid","line_width":"thick"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"}},"layout":{"x":0,"y":4,"width":4,"height":2}},{"id":6912052448667626,"definition":{"title":"Memory Usage %","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1 / query2 * 100"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"max:kubernetes.memory.usage{team:logs,datacenter:us1.prod.dog,kube_container_name:*,short_image:envoy} by {release}","data_source":"metrics","name":"query1"},{"query":"avg:kubernetes.memory.limits{team:logs,datacenter:us1.prod.dog,kube_container_name:*,short_image:envoy} by {release}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[{"value":"y > 100","display_type":"error dashed"},{"value":"80 < y < 100","display_type":"warning dashed"}]},"layout":{"x":0,"y":6,"width":4,"height":2}}]},"layout":{"x":8,"y":0,"width":4,"height":9}},{"id":8517294836877115,"definition":{"title":"Average Backend Response Time","show_legend":false,"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"avg:haproxy.backend.response.time{$eks_cluster, $pod_name, $aws_account}"}],"display_type":"line"}]},"layout":{"x":0,"y":2,"width":4,"height":2}},{"id":5596723900238160,"definition":{"title":"Backend Connection Errors Rate","show_legend":false,"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"data_source":"metrics","name":"query1","query":"sum:haproxy.backend.connection.errors.rate{$eks_cluster, $pod_name, $aws_account}"}],"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":4,"height":2}},{"id":8313904829146183,"definition":{"title":"Active Backend Servers","type":"query_value","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:haproxy.backend.active.servers{$eks_cluster, $pod_name, $aws_account}","aggregator":"last"}]}]},"layout":{"x":0,"y":6,"width":4,"height":2}},{"id":6642462222255886,"definition":{"title":"Top Servers by Session Rate","type":"toplist","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:haproxy.server.session.rate{$eks_cluster, $pod_name, $aws_account} by {server}","aggregator":"avg"}],"formulas":[{"formula":"query1","limit":{"count":10,"order":"desc"}}]}]},"layout":{"x":0,"y":8,"width":4,"height":2}},{"id":6000520031529074,"definition":{"title":"Overview","background_color":"blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":3338013985665394,"definition":{"title":"Incoming Success Rate (non-5xx responses)","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"(query3 + query1 + query2) / (query3 + query1 + query2 + query4) * 100"}],"conditional_formats":[{"comparator":">=","palette":"white_on_green","value":0.95},{"comparator":"<","palette":"white_on_yellow","value":0.95}],"response_format":"scalar","queries":[{"query":"sum:haproxy.backend.response.4xx{*} by {haproxy_service}","data_source":"metrics","name":"query3","aggregator":"avg"},{"query":"sum:haproxy.backend.response.3xx{*} by {haproxy_service}","data_source":"metrics","name":"query1","aggregator":"avg"},{"query":"sum:haproxy.backend.response.2xx{*} by {haproxy_service}","data_source":"metrics","name":"query2","aggregator":"avg"},{"query":"sum:haproxy.backend.response.5xx{*} by {haproxy_service}","data_source":"metrics","name":"query4","aggregator":"avg"}]}],"autoscale":true,"custom_unit":"%","precision":2},"layout":{"x":0,"y":0,"width":2,"height":2}},{"id":4638021867647926,"definition":{"title":"Incoming Requests Volume","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1 + query3 + query2 + query4"}],"response_format":"scalar","queries":[{"query":"sum:haproxy.backend.response.4xx{*}","data_source":"metrics","name":"query1","aggregator":"avg"},{"query":"sum:haproxy.backend.response.3xx{*}","data_source":"metrics","name":"query3","aggregator":"avg"},{"query":"sum:haproxy.backend.response.2xx{*}","data_source":"metrics","name":"query2","aggregator":"avg"},{"query":"sum:haproxy.backend.response.5xx{*}","data_source":"metrics","name":"query4","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":2,"y":0,"width":2,"height":2}},{"id":4982938716651224,"definition":{"title":"Errors by Service","title_size":"16","title_align":"left","requests":[{"formulas":[{"formula":"query1 + query2"}],"response_format":"scalar","queries":[{"query":"sum:haproxy.backend.response.4xx{*} by {service}","data_source":"metrics","name":"query1","aggregator":"avg"},{"query":"sum:haproxy.backend.response.5xx{*} by {service}","data_source":"metrics","name":"query2","aggregator":"avg"}]}],"type":"sunburst","legend":{"type":"table"}},"layout":{"x":0,"y":2,"width":4,"height":2}}]},"layout":{"x":4,"y":9,"width":8,"height":5}},{"id":2743588598871528,"definition":{"title":"Client Error HTTP Responses (4XX)","type":"query_value","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:haproxy.frontend.http.response.code.client_error{$eks_cluster, $pod_name, $aws_account}","aggregator":"avg"}]}]},"layout":{"x":0,"y":10,"width":4,"height":2}},{"id":5470866174553799,"definition":{"title":"Server Error HTTP Responses (5XX)","type":"query_value","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"avg:haproxy.frontend.http.response.code.server_error{$eks_cluster, $pod_name, $aws_account}","aggregator":"avg"}]}]},"layout":{"x":0,"y":12,"width":4,"height":2}}],"template_variables":[{"name":"eks_cluster","prefix":"eks_cluster","available_values":[],"default":"all"},{"name":"pod_name","prefix":"pod_name","available_values":[],"default":"all"},{"name":"aws_account","prefix":"aws_account","available_values":[],"default":"all"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed"}
